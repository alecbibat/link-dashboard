<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tracking Links Dashboard</title>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAhGzkAZWcSKwFSIA8O2EWUk8yTH5JarXw",
      authDomain: "link-dashboard-fbee7.firebaseapp.com",
      projectId: "link-dashboard-fbee7",
      storageBucket: "link-dashboard-fbee7.firebasestorage.app",
      messagingSenderId: "872237474804",
      appId: "1:872237474804:web:2bebc367be02b55735cfa1"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const categoryDefaults = {
      "Fire": "https://upload.wikimedia.org/wikipedia/commons/6/6b/Fire_icon.svg",
      "Weather": "https://upload.wikimedia.org/wikipedia/commons/e/e2/Weather-icon-sun.svg",
      "AED Locator": "https://upload.wikimedia.org/wikipedia/commons/f/fd/AED_icon.svg",
      "Tornado": "https://upload.wikimedia.org/wikipedia/commons/d/dd/Tornado_icon.svg",
      "Ship Tracker": "https://upload.wikimedia.org/wikipedia/commons/2/29/Ship_icon.svg",
      "Lightning": "https://upload.wikimedia.org/wikipedia/commons/2/25/Lightning_icon.svg"
    };

    async function loadLinks() {
      const snapshot = await getDocs(collection(db, "links"));
      snapshot.forEach(doc => {
        const { category, name, url, icon } = doc.data();
        createLinkButton(category, name, url, icon);
      });
    }

    async function storeLink(category, name, url, icon) {
      await addDoc(collection(db, "links"), { category, name, url, icon });
    }

    window.addEventListener('DOMContentLoaded', loadLinks);

    window.addLink = function () {
      const category = document.getElementById("category").value.trim();
      const name = document.getElementById("name").value.trim();
      const url = document.getElementById("url").value.trim();
      let icon = document.getElementById("icon").value.trim();

      if (!category || !name || !url) {
        alert("Please fill in all required fields.");
        return;
      }

      if (!icon) {
        try {
          icon = (new URL(url)).origin + '/favicon.ico';
        } catch (e) {
          icon = "";
        }
      }

      const testImg = new Image();
      testImg.onload = () => {
        storeLink(category, name, url, icon);
        createLinkButton(category, name, url, icon);
      };
      testImg.onerror = () => {
        const fallback = categoryDefaults[category] || 'https://upload.wikimedia.org/wikipedia/commons/a/ac/No_image_available.svg';
        storeLink(category, name, url, fallback);
        createLinkButton(category, name, url, fallback);
      };
      testImg.src = icon;
    }

    window.createLinkButton = function (category, name, url, icon) {
      let categoryDiv = document.querySelector(`[data-category='${category}']`);

      if (!categoryDiv) {
        categoryDiv = document.createElement("div");
        categoryDiv.className = "category";
        categoryDiv.setAttribute("data-category", category);
        categoryDiv.innerHTML = `<h2>${category}</h2>`;
        document.getElementById("links-container").appendChild(categoryDiv);
      }

      const linkHTML = `<a href="${url}" target="_blank" class="link-button" style="background-image: url('${icon}');"><span>${name}</span></a>`;
      categoryDiv.innerHTML += linkHTML;

      document.getElementById("category").value = "";
      document.getElementById("name").value = "";
      document.getElementById("url").value = "";
      document.getElementById("icon").value = "";
    }
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #1e1e1e;
      color: #fff;
      margin: 0;
      padding: 20px;
    }
    h2 {
      border-bottom: 2px solid #444;
      padding-bottom: 5px;
      margin-top: 30px;
    }
    .category {
      margin-bottom: 30px;
    }
    .link-button {
      display: inline-block;
      width: 180px;
      height: 100px;
      margin: 10px;
      background-size: cover;
      background-position: center;
      border: 2px solid #ccc;
      border-radius: 10px;
      text-align: center;
      line-height: 100px;
      color: white;
      text-decoration: none;
      font-weight: bold;
      background-color: #444;
      position: relative;
    }
    .link-button span {
      background-color: rgba(0, 0, 0, 0.6);
      padding: 5px 10px;
      border-radius: 5px;
    }
    .form-container {
      margin-top: 40px;
      padding: 20px;
      background-color: #2e2e2e;
      border-radius: 10px;
    }
    .form-container input, .form-container button {
      padding: 10px;
      margin: 5px;
      border-radius: 5px;
      border: none;
    }
    .form-container input {
      width: 200px;
    }
  </style>
</head>
<body>
  <h1>Tracking Links Dashboard</h1>

  <div id="links-container"></div>

  <div class="form-container">
    <h2>Add New Link</h2>
    <input type="text" id="category" placeholder="Category" />
    <input type="text" id="name" placeholder="Name" />
    <input type="text" id="url" placeholder="URL" />
    <input type="text" id="icon" placeholder="Favicon URL (optional)" />
    <button onclick="addLink()">Add Link</button>
  </div>
</body>
</html>
